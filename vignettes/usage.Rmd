---
title: "Usage"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Usage}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

LaminDB is an open-source data framework for biology. You can find out about some of its features in the [documentation of the lamindb Python package](https://docs.lamin.ai/introduction).

This vignette will show you how to use the `laminr` package to interact with LaminDB.

## Initial setup

### Python package

As part of a first-time set up, you will need to install the Python `lamin-cli` package, and set up an instance for first use.

```bash
pip install lamin-cli
lamin connect laminlabs/cellxgene
```

### R package

You will also need to install the `laminr` R package.

```{r install, eval = FALSE}
# Install the remotes package if needed
if (!requireMethods("remotes", quiety = TRUE)) {
  install.packages("remotes")
}
remotes::install_github("laminlabs/laminr")
```

#### Suggested dependencies

Some functionality requires additional suggested dependencies.
You will be prompted to install these packages when needed, or you can install them in advance.
Setting `dependencies = TRUE` will install all suggested packages.

```{r install-suggested, eval = FALSE}
remotes::install_github("laminlabs/laminr", dependencies = TRUE)
```

Or individual suggested packages can be installed with `install.packages()`.

Suggested dependecies:

- [anndata](https://cran.r-project.org/package=anndata) - Loading and saving `AnnData` objects
- [s3](https://cran.r-project.org/package=s3) - Caching objects to/from S3 storage

## Connect to a LaminDB instance

This vignette uses the [`laminlabs/cellxgene`](https://lamin.ai/laminlabs/cellxgene) instance, which is a LaminDB instance that interfaces the CELLxGENE data.

You can connect to the instance using the `connect` R function:

```{r connect}
library(laminr)

db <- connect("laminlabs/cellxgene")
```

By printing the instance, you can see which registries are available, including Artifact, Collection, Feature, etc. Each of these registries have a corresponding [Python class](https://docs.lamin.ai/lamindb).

```{r print_instance}
db
```

All of the 'core' registries are directly available from the `db` object, while registries from other modules can be accessed via `db$<module_name>`, e.g.:

```{r get_module}
db$bionty
```

The `bionty` and other registries also have corresponding [Python classes](https://docs.lamin.ai/bionty).

## Registry

A registry is used to query, store and manage data. For instance, the `Artifact` registry stores datasets and models as files, folders, or arrays.

You can see which functions you can use to interact with the registry by printing the registry object:

```{r get_artifact_registry}
db$Artifact
```

You can also get a data frame summarising the records associated with a registry.

```{r artifact-registry-df}
db$Artifact$df(limit = 5)
```

## Artifact

Artifacts can be fetched from the Artifact registry by ID or UID. For example, Artifact [KBW89Mf7IGcekja2hADu](https://lamin.ai/laminlabs/cellxgene/artifact/KBW89Mf7IGcekja2hADu) is an AnnData object containing myeloid cells.

```{r get_artifact}
artifact <- db$Artifact$get("KBW89Mf7IGcekja2hADu")
```

You can view its metadata by printing the object:

```{r print_artifact}
artifact
```

Or get more detailed information by calling the `$describe()` method:

```{r describe_artifact}
artifact$describe()
```

You can access its fields as follows:

* `artifact$id`: `r artifact$id`
* `artifact$uid`: `r artifact$uid`
* `artifact$key`: `r artifact$key`

Or fetch data from related registries:

* `artifact$root`: `r artifact$storage$to_string()`
* `artifact$created_by`: `r artifact$created_by$to_string()`

Some fields of an Artifact contain links to related information.

```{r artifact-related}
artifact$developmental_stages
```

Summaries of related information can be retrieved as a data frame.

```{r}
artifact$developmental_stages$df()
```

Finally, you can directly fetch or download the data for the Artifact using `$cache()` and `$load()`, respectively.

```{r cache_artifact}
artifact$cache()
artifact$load()
```

:::{.callout-note}
Only S3 storage and AnnData accessors are supported at the moment. If additional storage and data accessors are desired, please open an issue on the [laminr GitHub repository](https://github.com/laminlabs/laminr/issues).
:::
